VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
END
Attribute VB_Name = "Sheet5"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True



Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
  On Error GoTo catchError


  Exit Sub
'エラー発生時=====================================================================================
catchError:
  Call Library.endScript
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
  Dim selectCells As String
  Dim line As Long, activeCellLine As Long

  On Error GoTo catchError
  
  Call init.setting
  selectCells = Selection.Address(False, False)


  If Cells(Target.row, Target.Column).Style = "Error" Then
    Cells(Target.row, Target.Column).Style = "Normal"
  
  ElseIf selectCells Like "*:*" Then
    Exit Sub
  
  
  '担当者を複数選択するとき
  ElseIf Target.Column = Library.getColumnNo(setVal("cell_Assign")) And Target.Value = "複数選択" Then
    Call Library.startScript
    Call WBS_Option.担当者の複数選択
    Call Library.endScript
  
  '担当者を複数選択でないとき
  ElseIf Target.Column = Library.getColumnNo(setVal("cell_Assign")) Then
    Call Library.startScript
    
    activeCellLine = ActiveCell.row
    line = activeCellLine + 1
      
    Do While Range(setVal("cell_Info") & line) = setVal("TaskInfoStr_Multi")
      line = line + 1
    Loop
    If line > activeCellLine + 1 Then
      Rows(activeCellLine + 1 & ":" & line - 1).Delete Shift:=xlUp
    End If
    Range(setVal("cell_TaskAllocation") & Target.row) = ""
    Range(setVal("cell_Info") & Target.row) = ""
    
    Call Library.endScript
  ElseIf Intersect(Target, Columns("C:R")) Is Nothing Then
    Exit Sub
  Else
    If Range("A" & Target.row) = "" And Cells(Target.row, Target.Column) <> "" Then
      Call Library.startScript
      
      Call Calendar.行書式コピー(Target.row, Target.row)
      'Range(setVal("cell_PlanStart") & Target.row).Select
      Cells(Target.row, Target.Column).Select
      
      Call Library.endScript
      Exit Sub
    End If
  End If
    
  
  Exit Sub

'エラー発生時=====================================================================================
catchError:
  Call Library.showNotice(Err.Number, Err.Description, True)
End Sub



Private Sub Worksheet_SelectionChange(ByVal Target As Range)
  Dim line As Long
  
  Call init.setting
  If changeShapesName <> "" Then
    Call Library.startScript
    Call Chart.changeShapes
    Call Library.endScript(True)
  ElseIf Cells(Target.row, Target.Column) = "＋" Then
    Call Library.startScript
    line = Target.row + 1
    Do While Range(setVal("cell_Info") & line) Like "*" & setVal("TaskInfoStr_Multi") & "*"
      line = line + 1
    Loop
    
    Cells(Target.row, Target.Column) = "−"
    Rows(Target.row + 1 & ":" & line - 1).EntireRow.Hidden = False
    Range(setVal("cell_TaskArea") & Target.row + 1).Select
    Call Library.endScript
  ElseIf Cells(Target.row, Target.Column) = "−" Then
    Call Library.startScript
    line = Target.row + 1
    Do While Range(setVal("cell_Info") & line) Like "*" & setVal("TaskInfoStr_Multi") & "*"
      line = line + 1
    Loop
    
    Cells(Target.row, Target.Column) = "＋"
    Rows(Target.row + 1 & ":" & line - 1).EntireRow.Hidden = True
    Range(setVal("cell_TaskArea") & Target.row + 1).Select
    Call Library.endScript
  End If
  
  Exit Sub

'エラー発生時=====================================================================================
catchError:
  Call Library.showNotice(Err.Number, Err.Description, True)
End Sub



'**************************************************************************************************
' * 右クリックメニュー
' *
' * @author Bunpei.Koizumi<bunpei.koizumi@gmail.com>
'**************************************************************************************************
Private Sub Worksheet_BeforeRightClick(ByVal Target As Range, Cancel As Boolean)
  Dim menu01 As CommandBarControl
  
  If setVal("debugMode") = "develop" Then
    Exit Sub
  End If
  
  '標準状態にリセット
  Application.CommandBars("Cell").Reset

  If setVal("debugMode") <> "develop" Then
    '右クリックメニューをクリア
    For Each menu01 In Application.CommandBars("Cell").Controls
      'Debug.Print menu01.Caption
      Select Case True
        Case menu01.Caption Like "切り取り*"
        Case menu01.Caption Like "コピー*"
        Case menu01.Caption Like "数式と値のクリア*"
        Case menu01.Caption Like "貼り付け*"
'        Case menu01.Caption Like "セルの書式設定*"
'        Case menu01.Caption Like "挿入*"
'        Case menu01.Caption Like "削除*"
'        Case menu01.Caption Like "コメントの*"
        Case Else
          menu01.Visible = False
      End Select
    Next
  End If
      
      

  

  With Application.CommandBars("Cell").Controls.Add(temporary:=True)
      .Caption = "タスクにスクロール"
      .OnAction = "menu.M_タスクにスクロール"
  End With
  
  With Application.CommandBars("Cell").Controls.Add(temporary:=True)
      .BeginGroup = True
      .Caption = "タスクのレベル上げ"
      .FaceId = 3161
      .OnAction = "menu.M_インデント増"
  End With

  With Application.CommandBars("Cell").Controls.Add(temporary:=True)
      .Caption = "タスクのレベル下げ"
      .FaceId = 3162
      .OnAction = "menu.M_インデント減"
  End With

  With Application.CommandBars("Cell").Controls.Add(temporary:=True)
      .BeginGroup = True
      .Caption = "タスクの挿入"
      .OnAction = "menu.M_タスクの挿入"
  End With

  With Application.CommandBars("Cell").Controls.Add(temporary:=True)
      .Caption = "タスクの削除"
      .OnAction = "menu.M_タスクの削除"
  End With


  Application.CommandBars("Cell").ShowPopup
  Application.CommandBars("Cell").Reset
  Cancel = True
End Sub

